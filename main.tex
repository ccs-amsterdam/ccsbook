% !BIB TS-program = biber
% !BIB program = biber
\documentclass[a4paper,12pt]{book}
\usepackage[utf8]{inputenc}
\usepackage{lmodern,textcomp}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{url}
\usepackage{wrapfig}
\usepackage{newfloat}

\usepackage{tcolorbox}

\usepackage{codex}

\tcbuselibrary{skins,breakable,xparse,raster}

\usepackage[scaled]{beramono}
\usepackage[T1]{fontenc}

\usepackage[
backend=biber,
style=apa,
natbib=true,
sortlocale=en_US,
url=true, 
doi=true,
eprint=false
]{biblatex}
\addbibresource{references.bib}

%to make line breaks possible at more parts within \texttt
\renewcommand{\texttt}[1]{%
	\begingroup
	\ttfamily
	\begingroup\lccode`~=`/\lowercase{\endgroup\def~}{/\discretionary{}{}{}}%
	\begingroup\lccode`~=`[\lowercase{\endgroup\def~}{[\discretionary{}{}{}}%
	\begingroup\lccode`~=`.\lowercase{\endgroup\def~}{.\discretionary{}{}{}}%
	\begingroup\lccode`~=`(\lowercase{\endgroup\def~}{(\discretionary{}{}{}}%
	\catcode`/=\active\catcode`[=\active\catcode`.=\active\catcode`(=\active
	\scantokens{#1\noexpand}%
	\endgroup
}
        
\usepackage[colorinlistoftodos]{todonotes}


\usepackage{listings}
\lstset{
	basicstyle=\tiny\ttfamily,
	columns=flexible,
	breaklines=true,
	%stepsize=1,
}

\definecolor{darkblue}{rgb}{0,0,0.3}
\lstdefinestyle{r}{language=R,
  showstringspaces=false,
  stringstyle=\color{darkblue},
  morekeywords={select,filter,rename},
  numbers=left,
	numberstyle=\tiny\color{gray},
        numbersep=4pt,
}
\lstdefinestyle{py}{language=python,
  showstringspaces=false,
  stringstyle=\color{darkblue},
  morekeywords={select,filter,rename},
  numbers=left,
	numberstyle=\tiny\color{gray},
        numbersep=4pt,
}
\lstdefinestyle{out}{language={},
  showstringspaces=false,
  stringstyle=\color{darkblue},
  morekeywords={select,filter,rename},
}

\lstnewenvironment{exampler}{\lstset{basicstyle=\scriptsize\ttfamily,
		columns=flexible,
		breaklines=true,
		numbers=left,
		%stepsize=1,
		numberstyle=\tiny}}{}

\lstnewenvironment{ex_r_out}{\lstset{basicstyle=\scriptsize\ttfamily,
		columns=flexible,
		breaklines=true, 
		numbers=left,
		%stepsize=1,
		numberstyle=\tiny,
		backgroundcolor=\color[rgb]{0.3,0.3,1}}}{}

\lstnewenvironment{ex_r_in}{\lstset{basicstyle=\scriptsize\ttfamily,
		columns=flexible,
		breaklines=true,
		numbers=left,
                showlines=true,
		%stepsize=1,
		numberstyle=\tiny,
		backgroundcolor=\color[rgb]{0.5,0.5,1}}}{}

\lstnewenvironment{ex_py_out}{\lstset{basicstyle=\scriptsize\ttfamily,
		columns=flexible,
		breaklines=true,
		numbers=left,
		%stepsize=1,
		numberstyle=\tiny,
		backgroundcolor=\color[rgb]{0,0.6,.25}}}{}

\lstnewenvironment{ex_py_in}{\lstset{basicstyle=\scriptsize\ttfamily,
		columns=flexible,
		breaklines=true,
		numbers=left,
		%stepsize=1,
                showlines=true,
		numberstyle=\tiny,
		backgroundcolor=\color[rgb]{0.2,0.6,0.5}}}{}

\lstnewenvironment{examplepy}{\lstset{basicstyle=\scriptsize\ttfamily,
		columns=flexible,
		breaklines=true,
		numbers=left,
		%stepsize=1,
		numberstyle=\tiny,
		%backgroundcolor=\color[rgb]{.7,.7,.7}}}{}
		backgroundcolor=\color[rgb]{0,.6,.25}}}{}

\newcommand{\refsec}[1]{Section~\ref{sec:#1}}
\newcommand{\reffig}[1]{Figure~\ref{fig:#1}}
\newcommand{\reftab}[1]{Table~\ref{tab:#1}}
\newcommand{\refex}[1]{Example~\ref{ex:#1}}

\newcommand{\code}[1]{\texttt{#1}}

\newcommand{\note}[1]{\noindent\fbox{
  \begin{minipage}{\textwidth}
    \textbf{Note:} #1
  \end{minipage}}}


\lstnewenvironment{terminal}{\lstset{basicstyle=\scriptsize\ttfamily,
		columns=flexible,
		breaklines=true,
		numbers=left,
		%stepsize=1,
		numberstyle=\tiny,
		backgroundcolor=\color[rgb]{.7,.7,.7}}}{}



\newcommand{\rex}[1]{%
\begin{tcolorbox}[colback=red!5!white,colframe=red!75!black,title=R code]
  \lstinputlisting[style=r]{#1.r}
  \tcbsubtitle{Output}
  \lstinputlisting[style=out]{#1.r.out}
\end{tcolorbox}}

\newcommand{\pyex}[1]{%
\begin{tcolorbox}[colback=red!5!white,colframe=red!75!black,title=Python code]
  \lstinputlisting[style=py]{#1.py}
  \tcbsubtitle{Output}
  \lstinputlisting[style=out]{#1.py.out}
\end{tcolorbox}}

\newtcolorbox{rbox}[1]{#1}

\newcommand{\rpyex}[2]{
  \begin{example}
  \begin{tcbraster}[raster columns=2,raster equal height=rows,raster valign=top]
    \rex{#1}
    \pyex{#1}
  \end{tcbraster}
  \caption{#2}
  \end{example}
}

\newcommand{\rexcode}[1]{%
\begin{tcolorbox}[colback=red!5!white,colframe=red!75!black,title=R code]
  \lstinputlisting[style=r]{#1.r}
\end{tcolorbox}}

\newcommand{\pyexcode}[1]{%
\begin{tcolorbox}[colback=red!5!white,colframe=red!75!black,title=Python code]
  \lstinputlisting[style=py]{#1.py}
\end{tcolorbox}}


\newcommand{\rpyexcode}[2]{
  \begin{example}
  \begin{tcbraster}[raster columns=2,raster equal height=rows,raster valign=top]
    \rexcode{#1}
    \pyexcode{#1}
  \end{tcbraster}
  \caption{#2}
  \end{example}
}


%\includeonly{ch_data_wrangling/ch_data_wrangling}
\includeonly{chapter06/chapter06, ch_data_wrangling/ch_data_wrangling}

\begin{document}

\author{Wouter van Atteveldt, Damian Trilling, Carlos Arcila Calder\'on}
\title{Computational Analysis of Communication}
\date{\today}

\frontmatter
\maketitle
\tableofcontents

\mainmatter

\part{Getting Started}

\setcounter{chapter}{1}
\include{chapter02/chapter02}
\include{chapter03/chapter03}

\setcounter{chapter}{5}
\include{chapter06/chapter06}

\part{From Data to Science}

\setcounter{chapter}{6}
\include{ch_data_wrangling/ch_data_wrangling}

\setcounter{chapter}{8}
\include{chapter09/chapter09}


\setcounter{chapter}{11}
\include{chapter12/chapter12}

\backmatter
% bibliography, glossary and index would go here.

\begin{small}
\printbibliography
\end{small}


\end{document}

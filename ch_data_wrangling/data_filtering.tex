\section{Filtering, selecting and renaming}


\paragraph{Selecting and renaming columns}
A first clean up step we often want to do is removing unnecessary columns and renaming columns with unclear or overly long names.
In particular, it is often convenient to rename columns that contain spaces or non-standard characters, so it is easier to refer to them later.

\paragraph{Selecting rows}
As a next step, we can decide to filter certain rows.
For example, we might want to use only a subset of the data,
or we might want to remove certain rows because they are incomplete or incorrect.

As an example, FiveThirtyEight published a quiz about American public opinion about guns,
and were nice enough to also publish the underlying data\footnote{https://projects.fivethirtyeight.com/guns-parkland-polling-quiz/; see https://github.com/fivethirtyeight/data/tree/master/poll-quiz-guns for the underlying data.}.
\refex{data-filter} gives an example of loading and cleaning this data set, starting with the function \fn{read\_csv} (included in both \pkg{tidyverse} and \pkg{pandas}) to load the data directly from the Internet.
This data set contains one poll result per row, with a \emph{Question} column indicating which question was asked,
and the columns listing how many Americans (adults or registered voters) were in favor of that measure, in total and for Republicans and Democrats.
Next, the columns \emph{Republican} and \emph{Democratic Support} are renamed to shorten the names and remove the space.
Then, the URL column is dropped using the \pkg{tidyverse} function \fn{select} in R or the \pkg{pandas} function \fn{drop} in Python.
Notice that the result of these operations is assigned to the same object \texttt{d}.
This means that the original \texttt{d} is overwritten.

\note{[R] In R, the \pkg{tidyverse} function \fn{select} is quite versatile.
  You can specify multiple columns using \verb|select(d, column1, column2)| 
  or by specifying a range of columns: \verb|select(d, column1:column3)|.
  Both commands keep only the specified columns. 
  As in the example, you can also specify a negative selection with the minus sign: 
  \verb|select(d, -column1)| drops \texttt{column1}, keeping all other columns.
  Finally, you can rename columns in the select command as well: 
  \verb|select(d, column1=col1, column2)| renames \texttt{col} to \texttt{column1},
  keeps that column and \texttt{column2},and drops all other columns.
  }
  
We then filter the data set to list only the polls on whether teachers should be armed
(you can understand this is close to our heart).
This is done by comparing the value of the \emph{Question} column to the value \texttt{'arm-teachers'}.
This comparison is done with a double equals sign (\verb+==+).
In both Python and R, a single equals sign is used for assignment,
and a double equal sign is used for comparison.
A final thing to notice is that while in R we used the \pkg{dplyr} function (\fn{filter}) to filter out rows,
in Python we \emph{index} the data frame using square brackets on the \pkg{pandas} DataFrame attribute \fn{loc}(ation): \verb+d.loc[]+.

Note that we chose to assign the result of this filtering to \texttt{d2},
so after this operation we have the original full data set \texttt{d} as well as the subset \texttt{d2} at our disposal.
In general, it is your choice whether you overwrite the data by assigning to the same object,
or create a copy by assigning to a new name.
If you will later need to work with a different subset, it is smart to keep the original so you can subset it again later.
On the other hand, if all your analyses will be on the subset, you might as well overwrite the original.
We can always re-download it from the internet (or reload it from our harddisk) if it turns out we needed the original anyway. 

\pyrex[caption=Filtering,output=r,format=table]{ch_data_wrangling/data-filter}



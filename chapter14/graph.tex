\section{Representing and visualizing networks}
\label{sec:graph}

How can networks help us to understand and represent social problems? How can we use social media as a source for small and large-scale network analysis? In the computational analysis of communication these questions become highly relevant given the huge amount of social media data produced every minute on the Internet. In fact, even if graph theory and SNA were widely used during the last two decades of the 20th century, we can say that the appearance of computers and the Internet generated an important milestone that unleashed their potential. Firstly, computers made it easier to compute graph measures and visualize their general and communal structures. Secondly, the emergence of a big spectrum of social media network sites (i.e. Facebook, Twitter, Sina Weibo, Instagram, Linkedin, etc.) produced an unprecedented number of online social interactions, which still is certainly an excellent arena to apply this framework. Thus, the use of social media as a source for network analysis has become one of the most exciting and promising areas in the field of computational social science.

This section presents a brief overview of graph structures (nodes and edges) and types (directed, weighted, etc.), together with their formats in R and Python. We also include visual representations and basic graph analysis.  
 
A graph is a structure derived from a set of elements and their relationships. The element could be a neuron, a person, an organization, a street, or even a message, and the relationship could be a synapse, a trip, a commercial agreement, a drive connection or a content transmission. This is a different way to represent, model and analyze the world: instead of having rows and columns as in a typical dataframe, in a graph we have \textit{nodes} (components) and \textit{edges} (relations). The mathematical representation of a graph G=(V,E) is based on a set of nodes (also called vertices): \[{v_{1}, v_{2},… v_{n}}\] And the edges or pair of nodes: \[{(v_{1}, v_{2}), (v_{1}, v_{3}), (v_{2},v_{3}) … (v_{m}, v_{n}) \in E}\] As you may imagine, it is a very versatile procedure to represent many kinds of situations that include social, media or political interactions. In fact, if we go back to 1934 we can see how graph theory (originally established in the 18th century) was first applied to the representation of social interactions \citep{moreno1934shall} in order to measure the attraction and repulsion of individuals of a social group\footnote{See also de mathematical problem of the \textit{Seven Bridges of Königsberg}, formulated by Leonhard Euler in 1736 and that is considered the basis of graph theory. Inspired by a city divided by a river and connected by several bridges, the problem consisted on walking through the whole city crossing each bridge exactly once.}.

The network approach in social sciences has an enormous potential to model and predict \textit{social actions}. There is empirical evidence that we can successfully apply this framework to explain distinct phenomena such as political opinions, obesity, and happiness, given the influence of our friends (or even of the friends of our friends) over our behaviour \citep{christakis2009connected}. The network created by this sophisticated structure of human and social connections is an ideal scenario to understand how close we are from each other in terms of degrees of separation \citep{watts2004six} in small (i.e. a school) and large-scale (i.e. global pandemic) social dynamics. Moreover, the network approach can help us to track the propagation either of a virus in epidemiology, or a fake news story in political and social sciences, such as in the work by 
\citet{vosoughi2018spread}. 

Now, let us show you how to create and visualize network structures in R and Python. As we mentioned above, the structure of a graph is based on nodes and edges, which are the fundamental components of any network. Suppose that we want to model the social network of five American politicians in 2017 (Donald Trump, Bernie Sanders, Hillary Clinton, Barack Obama and John McCain), based on their \textit{imaginary} connections in Facebook (friending) and Twitter (following)\footnote{The connections among this politicians on Facebook and Twitter in the examples are of course purely fictional and were created \textit{ad hoc} to illustrate small social networks}. Technically, the base of any graph is a list of edges (written as pair of nodes that indicate the relationships) and a list of nodes (some nodes might be isolated without any connection!).  For instance, the friendship in Facebook between two politicians would normally be expressed as two strings separated by comma (i.e. "Hillary Clinton", "Donald Trump"). In \refex{graph} we use libraries \pkg{igraph} (R)\footnote{You can use this library in Python with the adapted package \pkg{python-igraph}} and \pkg{networkx} (Python) to create from scratch a simple graph with 5 nodes and 4 edges, using the above-mentioned structure of pairs of nodes (notice that we only include the edges while the vertices are automatically generated).

\pyrex[output=both,caption=Creating a graph from scratch]{chapter14/graph}

In both cases we generated a graph object \texttt{g1} which contains the structure of the network and different attributes (such as \verb|number_of_nodes()| in \pkg{networkx}). You can add/remove nodes and edges to/from this initial graph, or even modify the names of the vertices. One of the most useful functions is the visualization of the network (\fn{plot} in \pkg{igraph} and \fn{draw} or \fn{draw\_networkx} in \pkg{networkx}). \refex{visgraph} shows a basic visualization of the imaginary network of friendships of five American politicians in Facebook.


\begin{ccsexample}
  \doublecodex{chapter14/visgraph}
  \codexpng{Undirected graph}{.5\linewidth}{chapter14/visgraph.r}
  \caption{Visualization of a simple graph}
  \label{ex:visgraph}
\end{ccsexample}

Using network terminology, either nodes or edges can be \textit{adjacent} or not. In the figure we can say that nodes representing Donald Trump and John McCain are adjacent because they are connected by an edge that depicts their friendship. Moreover, the edges representing the friendships between John McCain and Donald Trump, and Hillary Clinton and Donald Trump, are also adjacent because they share one node (Donald Trump).

Now you know the relevant terminology and basics of working with graphs, you might be wondering: What if I want to do the same in Twitter? Can I represent the relationships between users in the very same way as Facebook? Well, when you model networks it is extremely important that you have a clear definition of what you mean with nodes and edges, in order to maintain a coherent interpretation of the graph. In both, Facebook and Twitter, the nodes represent the users, but the edges might not be the same. In Facebook, an edge represents the friendship between two users and this link \textit{has no direction} (once a user accepts a friend request, both users becomes friends). In the case of Twitter, an edge could represent various relationships. For example, it could mean that two users follow each other, or that one user is following another user, but not the other way around! In the latter case, the edge \textit{has a direction}, which you can establish in the graph. When you give directions to the edges you are creating a \textit{directed graph}. In \refex{directed} the directions are declared with the order of the pair of nodes: the first position is for the ``from'' and the second for the ``to''. In \pkg{igraph} (R) we  set the argument \verb+directed+ of the function \fn{make\_graph} to \verb+TRUE+. In \pkg{networkx} (Python), you use the class \cls{DiGraph} instead of \cls{Graph} to create the object \texttt{g2}.

\pyrex[output=both,caption=Creating a directed graph]{chapter14/directed}

In the new graph the edges represent the action of following a user in Twitter. The first declared edge indicates that Hillary Clinton follows Donald Trump, but does not indicate the opposite. In order to provide the directed graph with more \textit{arrows} we included in \texttt{g2} two new edges (Obama following Clinton and Clinton following Sanders), so we can have a couple of reciprocal relationships besides the unidirectional ones. You can visualize the directed graph in \refex{visdirected} and see how the edges now contain useful arrows.

\begin{ccsexample}
  \doublecodex{chapter14/visdirected}
  \codexpng{Directed graph}{.5\linewidth}{chapter14/visdirected.r}
  \caption{Visualization of a directed graph}
  \label{ex:visdirected}
\end{ccsexample}


The edges and nodes of our graph can also have weights and features or attributes. When the edges have specific values that depict a feature of every pair of nodes (i.e. the distance between two cities) we say that we have a \textit{weighted graph}. This type of graphs is extremely useful for creating a more accurate representation of a network. For example, in our hypothetical network of American politicians in Twitter (\texttt{g2}) we can assign weights to the edges by including the number of likes that each politician has given to the followed user. This value  can serve as a measure of the distance between the nodes (i.e. the higher the number of likes the shorter the social distance). In \refex{weighted} we include the weights for each edge: Clinton has given 5 likes to Trumps' tweets, Sanders 20 to Clinton's messages, and so on. In the plot you can see how the sizes of the lines between the nodes change as a function of the weights.

\begin{ccsexample}
  \doublecodex{chapter14/weighted}
  \codexpng{Weighted graph}{.5\linewidth}{chapter14/weighted.r}
  \caption{Visualization of a weighted graph}
  \label{ex:weighted}
\end{ccsexample}


You can include more properties of the components of your graph. Imagine you want to use the number of followers of each politician to determine the size of the nodes, or the gender of the user to establish a color. In \refex{weighted2} we added the variable \emph{followers} to each of the nodes and asked the packages to plot the network using this value as the size parameter (in fact we multiplied the values by 0.001 to make it realistic on the screen, but you could also normalize these values when needed). We also included the variable \emph{party} that was later recoded in a new one called \emph{color} in order to represent Republicans with red and Democrats with blue.  You may need to add other features to the nodes or edges, but with this example you have an overview of what you can do.

\begin{ccsexample}
  \doublecodex{chapter14/weighted2}
  \codexpng{Weighted graph including vertex sizes}{.5\linewidth}{chapter14/weighted2.r}
  \caption{Visualization of a weighted graph including vertex sizes}
  \label{ex:weighted2}
\end{ccsexample}

We can  mention a third type of graphs: the \textit{induced subgraphs}, which are in fact subsets of nodes and edges of a bigger graph. We can represent these subsets as G' = V', E'. In \refex{subgraph} we extract two induced subgraphs from our original network of American politicians on Facebook (\texttt{g1}): the first (\texttt{g3}) is built with the edges that contain only Democrat nodes, and the second (\texttt{g4}) with edges formed by Republican nodes. There is also a special case of an induced subgraph, called a \textit{clique}, which is an independent or complete subset of an undirected graph (each node of the clique must be connected to the rest of the nodes of the subgraph).

\pyrex[output=both,caption=Induced subgraphs for Democrats and Republicans]{chapter14/subgraph}

Keep in mind that in network visualization you can always configure the size, shape and color of your nodes or edges. It is out of the scope of this book to go into more technical details, but you can always check the online documentation of the recommended libraries.

So far we have created networks from scratch, but most of the time you will have to create a graph from an existing data file. This means that you will need an input data file with the graph structure, and some functions to load them as objects onto your workspace in R or Python. You can import graph data from different specific formats (i.e. Graph Modeling Language -GML-, GraphML, JSON, etc.), but one popular and standardized procedure is to obtain the data from a text file containing a list of edges or a matrix. In \refex{read}  we illustrate how to read graph data in \pkg{igraph} and \pkg{networkx} using a simple adjacency list that corresponds to our original imaginary Twitter network of American politicians (\texttt{g2}).

\pyrex[output=both,caption=Reading a graph from a file]{chapter14/read}

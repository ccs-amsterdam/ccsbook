\section{Representing and visualizing networks}
\label{sec:graph}

How can networks help us to understand and represent social problems? Hos can we use social media as a source for small and large-scale network analysis? This section presents a brief overview of graph structures (nodes and edges) and types (directed, weighted, induced, etc.), together with their formats in R and Python. We also include basic graph analysis and visual representation. 
 
A graph is an elegant way to represent a set of elements and their relationships. The element could be a neuron, a person, an organization, a street or even a message, and the relationship could be a synapse, a trip, a commercial agreement, a drive connection or a content transmission. This is a different way to represent, model and analyse the world: instead of having rows and columns as in a typical dataframe, in a graph we have \textit{nodes} (components) and \textit{edges} (relations). The mathematical representation of a graph G=(V,E) is possible when we set the nodes (also called vertices): \[{v_{1}, v_{2},… v_{n}}\] And the edges or pair of nodes: \[{(v_{1}, v_{2}), (v_{1}, v_{3}), (v_{2},v_{3}) … (v_{m}, v_{n}) \in E}\] As you may imagine, it is a very versatile pr	ocedure to represent many kind of problems that includes social, media or political issues. In fact, if go back to 1934 we can see how graph theory (originally established in the 18th century) was firstly applied to the representation of social interactions (\cite{moreno1934shall}) in order to measure the attraction and repulsion of individuals of a social group.

The network approach in social sciences has an enormous potential to model and predict \textit{social influence}. There is empirical evidence that we can successfully apply this framework to explain distinct phenomena such as political opinions, obesity and happiness, given the influence of our friends (or even of the friends of our friends) over our behaviour. (\cite{christakis2009connected}). The network created by this sophisticated structure of human and social connections is an ideal scenario to understand how close we are from each other in terms of degrees of separation (\cite{watts2004six}) in small (i.e. a school) and large-scale (i.e. global pandemic) social dynamics. Moreover, the network approach can help us to track the propagation either of a virus in epidemiology, or a fake news in political and social sciences, such in the work by 
\citet{vosoughi2018spread}. 

Even if graph theory and SNA were widely used during the last century, we can say that the appearance of computers and the Internet generated a important milestone that triggered their potentiality. Firstly, computers allowed to ease the computation of graph measures and visualize their general and communal structures. Secondly, the emergence of a big spectrum of social media network sites (i.e. Facebook, Twitter, Sina Weibo, Instagram, Linkedin, etc.) produced an unprecedented number of online social interactions, which was certainly an excellent arena to apply this framework. Thus, the use of social media as a source for network analysis has become one of the most exciting and promising areas in the field of computational social science.

Now, let us show you how to conduct basic representation and visualization of networks in R and Python. As we mentioned above, the structure of a graph is based on nodes and edges, which are the fundamental components of any network. Suppose that we want to model the social network of five American politicians in 2017 (Donald Trump, Bernie Sanders, Hillary Clinton, Barack Obama and John McCain), based on their \textit{imaginary} connections in Facebook (friendship) and Twitter (follow). Technically, the base of any graph is a list of edges that can written as pair of nodes that indicate 	the relationship.  For instance, the friendship in Facebook between two politicians would normally be expressed as two strings separated by comma (i.e. "Hillary Clinton", "Donald Trump"). In \refex{graph} we use libraries \pkg{igraph} (R)\footnote{You can use this library in Python with the adapted package \pkg{python-igraph}}  and \pkg{networkx} (Python) to create from scratch a simple graph with 5 nodes and 4 edges, using the above-mentioned structure of pair of nodes (notice that we only include the edges and the vertices are automatically generated).

\pyrex[output=both,caption=Creating a graph from scratch]{chapter14/graph}

In both cases we generated a graph object \texttt{g1} which contains the structure of the network and different attributes (such as \verb|number_of_nodes()| in 	\pkg{networkx}) and default functions. In the case of Python you can notice that the \pkg{networkx} object behaves very similar to a dictionary, which is a kind of object you are already familiar with.

We can add or drop node and edges to this initial graph, or even modify the names of the vertices. One of the most useful functions is the visualization of the network (\fn{plot} in \pkg{igraph} and \fn{draw} or \fn{draw\_networkx} in \pkg{networkx}). \refex{visgraph} shows a basic visualization of the imaginary network of friendships of five American politicians in Facebook.

\pyrex[output=both,format=png,caption=Visualization of a simple graph]{chapter14/visgraph}

Using network terminology, either nodes or edges can be \textit{adjacent} or not. In the figure we can say that nodes representing Donald Trump and John McCain are adjacent because they are connected by an edge that depicts its friendship. Moreover, the edges representing the friendships between John McCain and Donald Trump, and Hillary Clinton and Donald Trump, is also adjacent because they share one node (Donald Trump).

Now you you might be wondering: What if I want to do the same in Twitter? Can I represent the relationship between users in the very same way than Facebook? Well, when you model networks is extremely important that you have a clear definition of what you mean with nodes and edges, in order to maintain a coherence interpretation of the graph. In both, Facebook and Twitter, the nodes represent the users, but the edges might not be the same. In Facebook, an edge represents the friendship between two users and this link \textit{has no direction} (once an user accepts a friend request, both users becomes friends). In the case of Twitter, an edge could represent if one user is following another user, but not the other way around! This means that the edge \textit{has a direction} and you can establish it in the graph. When you give directions to the edges you are creating a \textit{directed graph}. In \refex{directed} the directions are declared with the order of the pair of nodes: the first position is for the "from" and the second for the "to". In \pkg{igraph} (R) we  set the argument \verb+directed+ of the function \fn{make\_graph} to \verb+TRUE+. In \pkg{networkx} (Python), you use the class \cls{DiGraph} instead of \cls{Graph} to create the object \texttt{g2}.

\pyrex[output=both,caption=Creating a directed graph]{chapter14/directed}

In the new graph the edges represent the action of following a user in Twitter. The first declared edge indicates that Hillary Clinton follows Donald Trump, but does not indicate the opposite. In order to provide the directed graph with more \textit{arrows} we included in \texttt{g2} two new edges (Barack Obama following Hillary Clinton, and Clinton following Bernie Sanders), so we can have a couple of reciprocal relationships besides the unidirectional ones. You can visualize the directed graph in \refex{visdirected} and see how the edges now contains useful arrows.

\pyrex[output=both,format=png,caption=Visualization of a directed graph]{chapter14/visdirected}

The edges and nodes of our graph can also have some weights, features or attributes. When the edges have specific values that depict a feature of every pair of nodes (i.e. the distance between two cities) we say that we have a \textit{weighted graph}. This type of graphs are extremely useful to have a more accurate representation of a network. For example, in our hypothetical network of American politicians in Twitter (\texttt{g2}) we can weight the edges by including the number of likes that each politician has given to the followed user. This value  can serve as a measure of the distance between the nodes (i.e. the higher the number of likes the shorter the social distance). In \refex{weighted} we include the weights for each edge: Clinton has given 5 likes to Trumps' tweets, Sander 20 to Clinton's messages, and so on. In the plot you can see how the sizes of the lines between the nodes change as a function of the weights.

\pyrex[output=both,format=png,caption=Visualization of a weighted graph]{chapter14/weighted}

You can include more properties to the components of your graph. Imagine you want to use the number of followers of each politician to determine the size of the nodes, or the gender of the user to establish a color. In \refex{weighted2} we added the variable \emph{followers} to each of the nodes and asked the packages to plot the network using this value as size parameter (in fact we multiplied the values by 0.001 to make realistic on the screen, boy you could also normalize these values when needed). We also included the variable \emph{party} that was later recoded in a new one called \emph{color} in order represent Republicans with red and Democrats with blue.  You may need to add other features to the nodes or edges, but with this example you have an overview of what you can do.

\pyrex[output=both,format=png,caption=Visualization of a weighted graph]{chapter14/weighted2}

We can  mention a third type of graphs: the \textit{induced subgraphs}, which are in fact subsets of nodes and edges of a bigger graph. We can represent these subsets as G' = V', E'. In \refex{subgraph} we extract two induced subgraphs from out original network of American politicians in Facebook (\texttt{g1}): the first (\texttt{g3}) is built with the edges that contain nodes only Democrat nodes, and the second \texttt{g4} with edges formed by Republican nodes. There is also special case of induced subgraphs, called \textit{clique}, which is an independent or complete subset of an undirected graph (each node of the clique must have a way to connect to the rest of the nodes of the subgraph).

\pyrex[output=both,caption=Induced subgraphs for Democrats and Republicans]{chapter14/subgraph}

Keep in mind that in network visualization you can always configure the size, shape and color of your nodes or edges. It is out of the scope of this book to go into more technical details, but you can always check the online documentation of the recommended libraries.

So far we have created networks from scratch, but most of the time you will have to create a graph from an existing data file. This means that you will need an input data file with the graph structure, and some functions to load them as objects onto your workspace in R or Python. You can import graph data from different specific formats (i.e. Graph Modeling Language -GML-, GraphML, JSON, etc.), but one popular and standardized procedure is to obtain the data from a text file containing a list of edges or a matrix. In \refex{read}  we illustrate how to read graph data in \pkg{igraph} and \pkg{networkx} using a simple adjacency list that corresponds to our original imaginary Twitter network of American politicians \texttt{g2}.

\pyrex[output=both,caption=Reading a graph from a file]{chapter14/read}

\section{Visualizing data}

Data visualization is a powerful technique for both understanding data yourself and communicating the story of your data to others. Based on R ggplot and Python matplotlib/seaborn, this section covers histograms, line and bar graphs, scatter plots and heatmaps. It touches on combining multiple graphs, communicating uncertainty with boxplots and ribbons, and plotting geospatial data.  In fact, visualizing data is an important stage in both EDA and advanced analytics, and we can use graphs to obtain important insights about our data. For example, if we want to visualize the age and the support of refugees of European citizens, we can plot a histogram and a bar graph, respectively. A histogram is used to examine the distribution of a continuous variable (function geom\_histogram() of ggplot in R and hist() of pandas in Python) and a graph bar to inspect the distribution of a categorical one (function geom\_bar() of ggplot in R and plot() of matplotlib in Python). In the provided code example you can easily notice the shape of the distribution of the variable age, with many values close to the average and a slightly bigger tail to the right (not that far from the normal distribution!).  In the case of the bar graph depicting the support to help refugees you can quickly get that the option “tend to agree” is for far the most important answer of the citizens, which means that most of them agree that their countries should help asylum seekers.

\textbf{XXX  hist  XXX}

There are many more basic visual representations that can help you to understand the data. The Eurobarometer collects data during 10 days (in the example from November 5 to 14, 2017) and you may wonder if the lever of support to refugees or even to general migrants changes over the time. This is actually a simple time series and you can use a graph line to represent it. Firstly you must transform the variables into numeric (from 1 to 4, being 4 the maximum support) and group them by day in order to get the average for each day. In the case of R, you can plot the two series using the base function plot(), or you can use the function geom\_line() of ggplot2. In the case of Python you can use the function plot() of matplotlib or the function lineplot() of seaborn.	

\textbf{XXX  line  XXX}

You can combine multiple graphs for a better communication of your initial results, giving the reader a broader and more comparative perspective. In the case of R, there are two ways of doing this. If you are plotting with base R, you can use the functions par()or layout(), in which you indicate where (row and columns) your figures must appear. If you are plotting with ggplot2, you can use the library gridExtra to generate this simple panel, or you can even integrate the two graphs into one by adding a new geom\_line() to the initial one, as shown in the example. In the case of Python you can use the function subplots() of matplotlib that allows you to configure multiple plots in a single one, or you can just plot the to figures and add the command show() to display an integrated figure, as shown in the example.  In the resulting combined graphs you can easily compare the trend of both variables and communicate that even when the support to refugees is higher than the support to migrants, both variables have the same behaviour over time.

\textbf{XXX  combine  XXX}

Now if you want to explore the possible correlation between the average support to refugees and the average support to migrants by year, you might need a scatterplot, which is a better figure to visualize the type and strength of this relationship. A scatterplot uses dots to depict the values of two variables in a Cartesian plane (with coordinates for the axes X and Y). You can easily plot this figure in R using the function geom\_point() in ggplot (and geom\_smooth() to display a regression line!), or in Python using scatterplot() in seaborn (and lmplot() for including the regression line). Looking at the dispersion of points in the provided example you can infer that there might be a positive correlation between the two variables, or in other words, the more the average support to refugees the more the average support to migrants over time.

\textbf{XXX  scatter  XXX}

Another useful representation is the heatmap. This figure can help you plot a continuous variable using a colour scale and show its relation with another two variables.  This means that you represent your data as colours, which might be useful for understanding patterns. For example, we may wonder what is the level of support of refugees given the nationality and the gender of the individual. For this visualization, it is necessary to create a proper dataframe to plot the heatmap, in which each number of your continuous variable (support\_refugees\_n) is included in a table where each axe (x= gender, y=country) represents the categorical variables. This pivoted table can be generated using some of the already explained commands.  In the first resulting figure proposed in the example, the lighter the blue the greater the support in each combination of country x gender. You can see that level of support is similar in countries such as Slovenia or Spain, and is different in Czech Republic or Austria. It also seems that women have a higher level of support. For this default heatmap we can use the function geom\_tile() of ggplot2 in R and heatmap() of seaborn in Python.  To personalize the scale colours (i.e. a scale of blues) we can use the function scale\_fill\_gradient() of ggplot2 in R or the parameter cmap of the function heatmap() of seaborn in Python. 

\textbf{XXX  heatmap  XXX}

As you have noticed, one of the goals of EDA is exploring the variance of our variables, which includes some uncertainty about their behaviour. We will introduce you to two basic plots to visually communicate this uncertainty. Firstly, ribbons and area plots can help us to clearly identify a predefined interval of a variable in order to interpret its variance over some cases. Let’s mark this interval in 0.15 points in the above-mentioned plots of the average support to refugees or migrants by day, and we can see that the lines tend to converge more in the very last day and are more separated by the day 4. This simple representation can be conducted in R using the function 	geom\_ribbon() of ggplot2 and in Python using the parameter ci of the function linepot() of seaborn.  

\textbf{XXX  ribbons  XXX}

Another way to show the uncertainty is using bloxplots, which are powerful representations of the distribution of our variables though the use of quartiles that are marked with the 25th, 50th (median) and 75th percentiles of any given variable. By examining the lower and upper levels of two or more distributions you can compare their variability and even detect possible outliers. You can generate multiple boxplots to compare the ages of the surveyed citizens by country and quickly get that in term of age the distributions of Spain and Greece are quite similar, but we can detect some differences between Croatia and the Netherlands. In R we use the function geom\_boxplot(), while in Python we use boxplot() of seaborn.

\textbf{XXX  boxplots  XXX}

Plotting geospatial data is a more powerful tool to compare countries.  Maps are very easy to understand and can have greater impact in all kind of readers, which make them a useful representation for a wide range of studies that any computational analyst has to deal with. Geospatial data is based on the specific location of any country, region, city or geographical area, marked by its coordinates, latitude and longitude, that can later build points and polygon areas. The coordinates are normally mandatory to plot any data on a map, but are not always provided in our row data. In those cases, we must joint the geographical information we have (i.e. the name of a country) with its coordinates in order to have an accurate dataframe for plotting geospatial data. Some libraries in R and Python might directly read and interpret different kinds of geospatial information by recognizing strings such as “France” or “Paris”, but at the end they will be converted into coordinates. 

Using the very same data of our example, we might want to plot in a map the level of support to refugees of European citizens by country. Firstly, we should create a dataframe with the average level of support to refugees by country and recode country names to standard names in English. Secondly, we must install any exiting library that provides you with accurate geospatial information. In the case of R, we recommend the package maps which contains the function map\_data() that helps you generate an object with geospatial information of specific areas, countries or regions, that can be easily read and plot by ggplot2. Even if not explained in this book, we also recommend ggmap in R \cite{kahle2013ggmap}. When working with Python we recommend geopandas that works very well with pandas and matplotlib (and will also need some additional packages such as descartes).  In the provided example we illustrate how to plot a world map (from existing geographical information) and then save a partial map into an object containing the European countries that participate in the survey. We then merge the dataframe and the map data (by region) a get a complete dataframe with coordinates for each country.  Finally, we plot it using the function geom\_polygon() of ggplot2 in R and the function plot() of geopandas in Python. Voilà a nice and comprehensible representation of our data with a scale of colours!

\textbf{XXX  map  XXX}

There are many other ways of visualizing data. For EDA we have covered in this chapter only some of the most used techniques but they might be still limited for your future work. We recommend you some in-depth readings about this topic\cite{tufte2006beautiful}\cite{cairo2019charts} as well as getting familiar with other packages such as shiny in R or bokeh in Python, that might be more adapted to your needs.

